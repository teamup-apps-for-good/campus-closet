<div style="display: flex;">
  <div style="flex: 1;">
    <div class="col-md-6 mb-6">
      <div class="card">
        <% if @item.image_url.present? %>
          <%= image_tag @item.image_url, class: "card-img-top img-fluid", alt: "Item Image", style: "object-fit: contain; height: 500px;" %>
        <% else %>
          <img src="placeholder_image_url" class="card-img-top img-fluid" alt="No image available" style="object-fit: contain; height: 500px;">
        <% end %>
        <div class="card-body">
          <%= render @item %>
          <p class="card-text">
            <%= link_to "Edit this item", edit_item_path(@item) %> |
            <%= link_to "Back to items", items_path %>
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <div style="flex: 1;">
    <div style="float: right;">
      <%= month_calendar(events: @time_slots, class: "text-center") do |date, time_slots| %>
        <div class="day">
          <h3 style="font-size: 18px; color: #2c3e50; font-weight: bold;"><%= date.strftime('%B %d, %Y') %></h3>
          <% time_slots.select { |time_slot| time_slot.status == 'available' }.each do |time_slot| %>
            <div class="time-slot">
              <p style="background-color: #2ecc71; padding: 10px; margin: 10px 0; font-family: 'Arial', sans-serif; font-size: 16px; color: #2c3e50;">
                <%= button_tag "#{time_slot[:start_time].strftime('%I:%M %p')} to #{time_slot[:end_time].strftime('%I:%M %p')}", id: "time_slot_button", data: { time_slot_id: time_slot.id } %>
              </p>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div>
  <%= button_to "Destroy this item", @item, method: :delete %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const timeSlotButtons = document.querySelectorAll('.time-slot button');

    timeSlotButtons.forEach(button => {
      button.addEventListener('click', function() {
        if (window.confirm('Are you sure you want to request this timeslot?')) {
          const timeSlotId = this.dataset.timeSlotId;
          const csrfToken = document.querySelector('meta[name="csrf-token"]').content;

          fetch(`/time_slots/${timeSlotId}/mark_unavailable`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': csrfToken
            },
            credentials: 'same-origin',
            body: JSON.stringify({ time_slot_id: timeSlotId }) // Optional: Send additional data if needed
          }).then(response => {
            if (response.ok) {
              alert('Time slot requested');
            } else {
              alert('Time slot requested');
            }
          }).catch(error => {
            console.error('Error:', error);
          });
        }
      });
    });
  });
</script>
